<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expiration Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-gray-300 min-h-screen p-6">

    <div class="max-w-3xl mx-auto">
        <h1 class="text-xl font-medium mb-6 border-b border-gray-800 pb-2 text-gray-100">Expiration Tracker</h1>

        <div class="bg-gray-900 border border-gray-800 p-6 mb-8 rounded-sm">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1">
                    <label class="block text-[10px] uppercase font-bold text-gray-500 mb-1 tracking-widest">Item Name</label>
                    <input type="text" id="itemName" placeholder="..." 
                        class="w-full bg-black border border-gray-700 rounded-sm p-2 text-gray-200 focus:outline-none focus:border-gray-500">
                </div>
                <div class="w-full md:w-48">
                    <label class="block text-[10px] uppercase font-bold text-gray-500 mb-1 tracking-widest">Expiration Date</label>
                    <input type="date" id="expDate" 
                        class="w-full bg-black border border-gray-700 rounded-sm p-2 text-gray-200 focus:outline-none focus:border-gray-500 color-scheme-dark">
                </div>
                <div class="flex items-end">
                    <button onclick="addItem()" 
                        class="w-full md:w-auto bg-gray-200 hover:bg-white text-black px-8 py-2 font-bold rounded-sm transition text-sm uppercase">
                        Add
                    </button>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <input type="text" id="searchInput" onkeyup="renderItems()" placeholder="Filter items..." 
                class="w-full bg-transparent border-b border-gray-800 p-2 focus:outline-none focus:border-gray-600 text-sm">
        </div>

        <div id="itemsContainer" class="space-y-1">
            </div>
    </div>

    <style>
        /* Ensures the date picker icon and interface looks correct in dark mode */
        .color-scheme-dark { color-scheme: dark; }
    </style>

    <script>
        let items = [];

        window.onload = () => {
            const cookieData = getCookie("food_tracker_data");
            if (cookieData) {
                items = JSON.parse(cookieData);
                renderItems();
            }
        };

        function setCookie(name, value) {
            const d = new Date();
            d.setTime(d.getTime() + (365 * 24 * 60 * 60 * 1000));
            document.cookie = name + "=" + JSON.stringify(value) + ";expires=" + d.toUTCString() + ";path=/";
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function addItem() {
            const name = document.getElementById('itemName').value;
            const date = document.getElementById('expDate').value;
            if (!name || !date) return;

            items.push({ name, expiration_date: date });
            setCookie("food_tracker_data", items);
            
            document.getElementById('itemName').value = "";
            document.getElementById('expDate').value = "";
            renderItems();
        }

        function deleteItem(index) {
            items.splice(index, 1);
            setCookie("food_tracker_data", items);
            renderItems();
        }

        function renderItems() {
            const container = document.getElementById('itemsContainer');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            container.innerHTML = "";

            const filteredItems = items
                .filter(item => item.name.toLowerCase().includes(searchTerm))
                .sort((a, b) => new Date(a.expiration_date) - new Date(b.expiration_date));

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            filteredItems.forEach((item) => {
                const expDate = new Date(item.expiration_date);
                const diffDays = Math.ceil((expDate - today) / (1000 * 60 * 60 * 24));

                let statusText = "Active";
                let statusClass = "text-gray-500";
                let borderClass = "border-gray-800";
                
                if (diffDays < 0) {
                    statusText = "Expired";
                    statusClass = "text-red-500";
                    borderClass = "border-red-900/30 bg-red-950/10";
                } else if (diffDays <= 3) {
                    statusText = "Urgent";
                    statusClass = "text-orange-500";
                    borderClass = "border-orange-900/30 bg-orange-950/10";
                }

                container.innerHTML += `
                    <div class="bg-gray-900/50 border ${borderClass} p-4 flex justify-between items-center">
                        <div>
                            <div class="font-normal text-gray-200">${item.name}</div>
                            <div class="text-[10px] uppercase tracking-widest mt-1">
                                <span class="text-gray-600">Expires: ${item.expiration_date}</span> 
                                <span class="mx-2 text-gray-800">|</span> 
                                <span class="${statusClass}">${statusText} (${diffDays} days)</span>
                            </div>
                        </div>
                        <button onclick="deleteItem(${items.indexOf(item)})" 
                            class="text-[10px] font-bold text-gray-600 hover:text-gray-200 transition uppercase tracking-tighter">
                            Remove
                        </button>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>